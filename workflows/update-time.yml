name: Update Last Updated Time

on:
  # 1. å½“ push ä»£ç åˆ° main åˆ†æ”¯æ—¶è§¦å‘ (å¦‚æœä½ çš„ä¸»åˆ†æ”¯å« masterï¼Œè¯·æŠŠä¸‹é¢çš„ main æ”¹æˆ master)
  push:
    branches:
      - main
  # 2. æ¯å¤©åŒ—äº¬æ—¶é—´æ—©ä¸Š 8 ç‚¹è‡ªåŠ¨è§¦å‘ (UTCæ—¶é—´ 0ç‚¹)
  schedule:
    - cron: '0 0 * * *'
  # 3. å…è®¸ä½ æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®è§¦å‘ (æ–¹ä¾¿æµ‹è¯•ç”¨)
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      # ç¬¬ä¸€æ­¥ï¼šæ‹‰å–ä»£ç 
      - name: Checkout code
        uses: actions/checkout@v3

      # ç¬¬äºŒæ­¥ï¼šè·å–æ—¶é—´å¹¶ä¿®æ”¹ README
      - name: Update time in README
        run: |
          # è®¾ç½®æ—¶åŒºä¸ºä¸Šæµ·/åŒ—äº¬æ—¶é—´ï¼Œå¹¶è·å–å½“å‰æ—¶é—´
          # æ ¼å¼ç¤ºä¾‹ï¼š2025-03-21 14:30:00
          TIME=$(TZ='Asia/Shanghai' date +'%Y-%m-%d %H:%M:%S')
          
          # æ‰“å°ä¸€ä¸‹æ—¶é—´ï¼Œæ–¹ä¾¿åœ¨æ—¥å¿—é‡Œçœ‹
          echo "Current time: $TIME"
          
          # ä½¿ç”¨ sed å‘½ä»¤æŸ¥æ‰¾ README ä¸­çš„å ä½ç¬¦ï¼Œå¹¶æ›¿æ¢ä¸­é—´çš„å†…å®¹
          # å¦‚æœä½ æƒ³æ”¹æ–‡å­—å†…å®¹ï¼Œä¿®æ”¹ä¸‹é¢ "ğŸ•’ æœ¬é¡¹ç›®æœ€è¿‘æ›´æ–°äºï¼š" è¿™éƒ¨åˆ†å³å¯
          sed -i "s/<!-- START_SECTION:update_time -->.*<!-- END_SECTION:update_time -->/<!-- START_SECTION:update_time -->\nğŸ•’ æœ¬é¡¹ç›®æœ€è¿‘æ›´æ–°äºï¼š$TIME\n<!-- END_SECTION:update_time -->/g" README.md

      # ç¬¬ä¸‰æ­¥ï¼šæäº¤æ›´æ”¹ (è¿™å°±æ˜¯é‚£ä¸ªé…ç½®æœºå™¨äººçš„åœ°æ–¹ï¼Œä¸éœ€è¦æ”¹)
      - name: Commit changes
        run: |
          # é…ç½® Git æœºå™¨äººä¿¡æ¯
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æœ‰å˜åŒ–
          if [[ -n $(git status -s) ]]; then
            echo "Changes detected. Committing..."
            git add README.md
            git commit -m "docs: auto update last updated time [skip ci]"
            git push
          else
            echo "No changes to commit."
          fi
